# Облачное хранилище
*Дипломная работа курса "Java-разработчик" от Нетологии*
### Описание

Сервис предназначен для хранения данных пользователей. Для доступа к интерфейсу хранения необходимо пройти аутентификацию по логину и паролю.
UI позволяет загружать файлы на сервер, изменять их название, просматривать список доступных файлов, загружать их на локальный компьютер и удалять файлы с сервера.
Размер каждого отдельно взятого файла может быть не более 512 мб.
___
### Технологический стек

**Frontend**: node-js

**Backend**: java 17 + postgresql

___
### Учетные данные пользователей

При запуске приложения в базе генерируется два тестовых пользователя:

**LOGIN:**  demo_user1  **PASSWORD:**   pass1
  
**LOGIN:**  demo_user2   **PASSWORD:**   pass2

___
### Техническая реализация

Серверная часть была написана по требованиям, указанным в предоставленной [спецификации OpenAPI](https://github.com/zzaharovs/netology-diploma/blob/develop/cloud-storage.yaml).

Сервис представляет собой SpringBoot приложение реализующее основные CRUD-операции и защищенное Spring Security. По дефолту frontend использует порт 8080, backend - 8787

Для общения с фронтенд-частью использовал Spring MVC. Приложение принимает запросы, валидирует переданные параметры, в случае выброса исключений передает стандартизированные сообщения

Для работы с базой использовал Spring JPA, для создания схемы, наполнения ее синтетикой и управления версиями чейнджсетов использован Liquibase. Для хранения данных используется postgresql, но теоретически приложение может работать на любой реляционной базе данных, использованный стек должен обеспечить кроссплатформенность. Первичным ключом для файлов является сочетание логина пользователя и имени файла, чтобы исключить вероятность ошибок при сохранении файлов с одинаковыми названиями для разных пользователей

Для аутентификации пользователя используется Spring Security + кастомный сервис по генерации и валидации JWT + кастомный фильтр аутентификации по JWT пользователя. Учетные данные пользователей и сгенерированные jwt хранятся в базе данных. При логауте или при ошибке валидации токена токен удаляется из базы

Приложение покрыто юнит-тестами и интеграционными тестами с использованием TestContainers

Для сборки проекта используется maven версии не ниже 3.8.1 (рекомендуется 3.8.4)

Для развертывания использованы docker и docker-compose

___
### Запуск приложения

#### Описание и запуск FRONT

    1. Установить nodejs (версия не ниже 14.15.0) на компьютер следуя [инструкции:](https://nodejs.org/ru/download/)
    2. Скачать [FRONT](https://github.com/zzaharovs/netology-cloud-storage-front)
    3. Перейти в папку FRONT приложения и все команды для запуска выполнять из нее.
    4. Следуя описанию README.md FRONT проекта запустить nodejs приложение
    5. Можно задать url для вызова своего backend сервиса:
        - В файле .env FRONT (находится в корне проекта) приложения нужно изменить url до backend, например: VUE_APP_BASE_URL=http://localhost:8080
        - Пересобрать и запустить FRONT снова: npm run build
        - Измененный url сохранится для следующих запусков.
    6. По умолчанию FRONT запускается на порту 8080 и доступен по url в браузере http://localhost:8080
    7. Для аутентификации FRONT приложение использует header auth-token в котором отправляет токен (ключ-строка) для идентификации пользователя на BACKEND. Для получения токена нужно пройти авторизацию на BACKEND и отправить на метод /login пару логин и пароль, в случае успешной проверки в ответ BACKEND должен вернуть json объект с полем auth-token и значением токена. Все дальейшие запросы с FRONTEND, кроме метода /login отправляются с этим header. Для выхода из приложения нужно вызвать метод BACKEND /logout, который удалит/деактивирует токен и последующие запросы с этим токеном будут не авторизованы и возвращать код 401.

#### Запуск BACKEND:

    1. Cкачать проект, в консоли запустить команду *mvn clean package*
    2. Запустить docker-compose.yml
    3. Приложение запустится по умолчанию на порту 8787 и будет доступно по url в браузере по адресу http//localhost:8787


